---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "hypercore_vm Resource - hypercore"
subcategory: ""
description: |-
  HypercoreVM resource to create a VM from a template VM
  A running VM might need to shutdown to apply required changes.
  In this case first a nice ACPI shutdown is tried.
  If the VM does not stop, a force shutdown is tried.
  In both cases the provider waits up to HC_VM_SHUTDOWN_TIMEOUT seconds for the VM to shutdown.
  HC_VM_SHUTDOWN_TIMEOUT dafault value is 300 seconds.
  HC_VM_SHUTDOWN_TIMEOUT can be changed via environ.
  The provider will currently try to shutdown VM only before VM delete.
---

# hypercore_vm (Resource)

HypercoreVM resource to create a VM from a template VM

A running VM might need to shutdown to apply required changes.
In this case first a nice ACPI shutdown is tried.
If the VM does not stop, a force shutdown is tried.
In both cases the provider waits up to HC_VM_SHUTDOWN_TIMEOUT seconds for the VM to shutdown.
HC_VM_SHUTDOWN_TIMEOUT dafault value is 300 seconds.
HC_VM_SHUTDOWN_TIMEOUT can be changed via environ.

The provider will currently try to shutdown VM only before VM delete.

## Example Usage

```terraform
locals {
  vm_meta_data_tmpl = "./assets/meta-data.ubuntu-22.04.yml.tftpl"
  vm_user_data_tmpl = "./assets/user-data.ubuntu-22.04.yml.tftpl"
  vm_name           = "my-vm"
}

resource "hypercore_vm" "empty-vm" {
  tags        = ["my-group"]
  name        = "empty-vm"
  description = "some description"

  vcpu   = 4
  memory = 4096 # MiB
}

data "hypercore_vms" "clone_source_vm" {
  name = "source_vm"
}

resource "hypercore_vm" "myvm" {
  tags        = ["my-group"]
  name        = local.vm_name
  description = "some description"

  vcpu                   = 4
  memory                 = 4096 # MiB
  snapshot_schedule_uuid = data.hypercore_vms.clone_source_vm.vms.0.snapshot_schedule_uuid

  clone = {
    source_vm_uuid = data.hypercore_vms.clone_source_vm.vms.0.uuid
    meta_data = templatefile(local.vm_meta_data_tmpl, {
      name = local.vm_name,
    })
    user_data = templatefile(local.vm_user_data_tmpl, {
      name                = local.vm_name,
      ssh_authorized_keys = "",
      ssh_import_id       = "",
    })
    preserve_mac_address = true # User wants to preserve mac address from the source machine (Default is false)
  }
}

resource "hypercore_vm" "import-from-smb" {
  tags        = ["my-group"]
  name        = "imported-vm"
  description = "some description"

  vcpu   = 4
  memory = 4096 # MiB

  import = {
    server    = "10.5.11.39"
    username  = ";administrator"
    password  = "***"
    path      = "/cidata"
    file_name = "example-template.xml"
  }
}

output "vm_uuid" {
  value = hypercore_vm.myvm.id
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `name` (String) Name of this VM

### Optional

- `affinity_strategy` (Object) VM node affinity. (see [below for nested schema](#nestedatt--affinity_strategy))
- `clone` (Attributes) Clone options if the VM is being created as a clone. The `source_vm_uuid` is the UUID of the VM used for cloning, <br>`user_data` and `meta_data` are used for the cloud init data. (see [below for nested schema](#nestedatt--clone))
- `description` (String) Description of this VM
- `import` (Attributes) Options for importing a VM through a SMB server or some other HTTP location. <br>Use server, username, password for SMB or http_uri for some other HTTP location. Parameters path and file_name are always **required** (see [below for nested schema](#nestedatt--import))
- `memory` (Number) Memory (RAM) size in `MiB`: If the cloned VM was already created <br>and it's memory was modified, the cloned VM will be rebooted (either gracefully or forcefully)
- `snapshot_schedule_uuid` (String) UUID of the snapshot schedule to create automatic snapshots
- `tags` (List of String) List of tags to create this VM in
- `vcpu` (Number) Number of CPUs on this VM. If the cloned VM was already created and it's <br>`VCPU` was modified, the cloned VM will be rebooted (either gracefully or forcefully)

### Read-Only

- `id` (String) HypercoreVM identifier

<a id="nestedatt--affinity_strategy"></a>
### Nested Schema for `affinity_strategy`

Optional:

- `backup_node_uuid` (String)
- `preferred_node_uuid` (String)
- `strict_affinity` (Boolean)


<a id="nestedatt--clone"></a>
### Nested Schema for `clone`

Required:

- `source_vm_uuid` (String)

Optional:

- `meta_data` (String)
- `preserve_mac_address` (Boolean)
- `user_data` (String)


<a id="nestedatt--import"></a>
### Nested Schema for `import`

Required:

- `file_name` (String)
- `path` (String)

Optional:

- `http_uri` (String)
- `password` (String, Sensitive)
- `server` (String)
- `username` (String)
